{% extends 'base.html' %}
{% block header %}
  <head>

      <script type = "text/javascript" > 
        function getCountdown(date) {
          var deadline = new Date(date);
          var today =  new Date(Date.now());
          var modulo = 12 % 9
          var Difference_In_Minutes = parseInt(deadline.getTime()-today.getTime())/(60*1000);
          var days = parseInt(Difference_In_Minutes / (60*24));
          var hours = parseInt((Difference_In_Minutes % (60*24)) / 60);
          var minutes = parseInt((Difference_In_Minutes % (60*24)) % 60);
          var timeLeft = days+" days, "+hours+" hours, "+minutes+" minutes";
          return timeLeft
        }
      </script>
  </head>
  <h1>{% block title %}Buyer Requests{% endblock %}</h1>
  {% if g.user %}
    <a class="action" href="{{ url_for('marketplace.create') }}">New</a>
  {% endif %}
{% endblock %}
{% block content %}
  {% for post in posts %}
  <div class="shadow-sm card" style="width: 100%; margin-top: 10px">
      <div class="card-body">
        <div class="card-title" style="width: 100%">
          <div class="float-left"><h5>{{ post.val()['title'] }}</h5></div>
          <div class="float-right"><i class="fas fa-dollar-sign"> {{post.val()["budget"]}}</i></div>
        </div>
        <br>
        <a href="/user/{{post.val()['author']}}">@{{post.val()['author']}}</a> Â· {{ utcFromTimestamp(post.val()['timestamp']).strftime('%Y-%m-%d')  }} at {{ utcFromTimestamp(post.val()['timestamp']).strftime('%H:%M') }}
        <hr>
        <p class="card-text">{{ post.val()['body'] }}.</p>
      </div>
      <ul class="list-group list-group-flush">
        <hr>
        <li class="list-group-item"><script>document.write(getCountdown("{{ post.val()['deadline'] }}"))</script> until deadline</li>
      </ul>
      <div class="card-body">
          {% if g.user %}
          <span class="btn-group"></span>
          {% if g.user['localId'] == post.val()['author'] %}
            <a class="btn btn-primary" href="{{ url_for('me.post', id=post.key()) }}">View</a></button>
            <a class="btn btn-dark" href="{{ url_for('marketplace.update', id=post.key()) }}">Edit</a>
          {% else %}
            <a class="btn btn-primary" href="{{ url_for('marketplace.bid', id=post.key()) }}">Bid</a>
          {% endif %}
        </span>
        {% endif %}
      </div>
    </div>


  {% endfor %}
{% endblock %}
